<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    
</head>
<body>
    
    <div class="container-fluid">
    <div class="row top-banner type-1">
        <div>Weather Dashboard</div>
    </div>
    <section class="row">
    <aside class="col-12 col-md-3 col-sm-12">
        <div class="search">
            <lable>Search for a City</lable>
            <div>
            <input></input>
           <button><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
            <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
          </svg></button>
            </div>
        <div class="search-history" id="search-history">
        </div>
    </aside>
    <main class="col-12 col-md-9 col-sm-12" >
        <div class="main-top col-md-12 col-12 col-sm-12" id="current-weather">
        </div>
        <div class="row col-sm-12 col-12" id="forecast-module">
            <div id="forecast-card"></div> 
                     
        </div>
        
        
        
        
    </main>
    </section>
    </div>

    <script type="text/javascript">
    
// Storage History Data

var historyData = []


// Get Current Weather

function displayCurrentWeather (){

    var cityName = $("input").val()
        var currentQueryURL = "http://api.openweathermap.org/data/2.5/weather?q=" + cityName + "&appid=4c023acf398932e1b43cd03002ad8542"
        
                           
        $.ajax({
          url: currentQueryURL,
          method: "GET"
        }).then(function(response) {
            $("#current-weather").text("")
            var currentDay = moment().format("(YYYY/MM/DD)")
            var currentCity = $("<div>").text(cityName + " " + currentDay)
            var humidity = response.main.humidity
            var temp = response.main.temp
            var windSpeed = response.wind.speed
            var tempConvert = (temp - 273.15) * 1.80 + 32
            var currentTemp = $("<div>").text("Temperture: " + parseInt(tempConvert) + "°F")
            var currentHumidity = $("<div>").text("Humidity: " + humidity + "%")
            var currentWindSpeed = $("<div>").text("Wind Speed: " + windSpeed + "MPH")
            

            $("#current-weather").append(currentCity, currentTemp ,currentHumidity, currentWindSpeed)
            currentCity.addClass("title")
            var storageCurrentData = {
                city: currentCity.text(),
                temp: currentTemp.text(),
                humidity: currentHumidity.text(),
                wind: currentWindSpeed.text(),

            };

            localStorage.setItem("current-data", JSON.stringify(storageCurrentData));
      });
}

    // Get Forecast Info
        function displayForecastCard (){

        var cityName = $("input").val()
        var queryURL = "http://api.openweathermap.org/data/2.5/forecast?q=" +
          cityName + "&appid=dba9fba66cd4f9dffd4e3bf4d8e74bfb";
        
                           
        $.ajax({
          url: queryURL,
          method: "GET"
        }).then(function(response) {

            $("#forecast-module").text("")

            
            // Loop for 5 days
            for(var i=0; i<response.list.length; i+=8){
            var futureDate = response.list[i].dt_txt
            var dateOnly = futureDate.substr(0,10)
            var futureTemp = response.list[i].main.temp
            var tempConvert = (futureTemp - 273.15) * 1.80 + 32
            var currentHumidity = response.list[i].main.humidity

            var forecastModule = $("<div>").html(dateOnly  + ("</br>Temp: " + parseInt(tempConvert)  + "°F") + ( "</br>Humidity: " + currentHumidity + "%"))
            forecastModule.addClass("forecast")
            forecastModule.attr("id", "forecast-module"+i)
            $("#forecast-module").append(forecastModule)

            var storageForecastData = {
                date: dateOnly,
                temp: tempConvert,
                humidity: currentHumidity,

            }

            localStorage.setItem("forecast-module"+i, $("#forecast-module"+i).text())
        }
  
      });

    }

    // Append City Name to History
    function displayHistory () {
        var cityHistory = $("<div>").text($("input").val())
        cityHistory.addClass("history-title")
        cityHistory.attr("value", cityHistory)
            
        $("#search-history").append(cityHistory)
        
        historyData.push(cityHistory.text())
       console.log(historyData)
       storeHistoryCityName()

       }
    //    Storage City Name
    function storeHistoryCityName() {
        localStorage.setItem("history-search-city-name", JSON.stringify(historyData))

    }
    

    
    // When Search Clicked
    
       $(function(){
        $("button").click(function(){
            displayCurrentWeather();
            displayForecastCard();
            displayHistory();
            storeHistoryCityName()
            
        })

       })

    // When Click on Search History 
  
       

    


    // When Refresh Page

    function renderHistroy () {

        // Render Search History
        
        var storeCityHistory = JSON.parse(localStorage.getItem("history-search-city-name"));
       

            if (storeCityHistory !== null){
                historyData=storeCityHistory
                
            }
            
            for (var i =0; i < storeCityHistory.length; i++){
           var cityHistory = $("<div>").text(storeCityHistory[i]);
            $("#search-history").append(cityHistory)
            cityHistory.addClass("history-title")
        
       
        }

        // Render Current Weather
        var getStoragedCurrentWeather = JSON.parse(localStorage.getItem("current-data"))
        var currentDay = moment().format("(YYYY/MM/DD)")
            var currentCity = $("<div>").text(getStoragedCurrentWeather.city)
            var humidity = getStoragedCurrentWeather.humidity
            var temp = getStoragedCurrentWeather.temp
            var windSpeed = getStoragedCurrentWeather.wind
            
            var currentTemp = $("<div>").text(temp)
            var currentHumidity = $("<div>").text(humidity)
            var currentWindSpeed = $("<div>").text(windSpeed)
        $("#current-weather").append(currentCity, currentTemp ,currentHumidity, currentWindSpeed)
            currentCity.addClass("title")
       
        // Render Forecast 
        for ( var i =0; i<33; i+=8){
            var getForecastStorageData = localStorage.getItem("forecast-module"+i)
        var forecastModule = $("<div>").text(getForecastStorageData)
            forecastModule.addClass("forecast")
            forecastModule.attr("id", "forecast-module"+i)
            $("#forecast-module").append(forecastModule)


        }
        

        
    }
    
    
    renderHistroy ()
    
    

 
    
    
    
       

        
  

        
    

     
     </script>
</body>
</html>



